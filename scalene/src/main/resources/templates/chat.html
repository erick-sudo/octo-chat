<!DOCTYPE html>
<html lang="en" class="bg-slate-200 flex flex-col">
<head>
    <meta charset="UTF-8">
    <title>Chat server</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .scrolll::-webkit-scrollbar {
            width: 0;
        }
    </style>
</head>
<body class="">
    <div class="fixed ring ring-4 ring-blue-800  flex flex-col inset-0 bg-slate-400">
        <div class="bg-blue-100 m-2 rounded-md">
            <div class="flex">
                <div class="scrolll flex flex-col overflow-y-scroll w-max h-96 m-4 border-r-2 border-white">
                    <div th:each="user: ${users}" class="gap-2 border border-black/50 rounded-full p-2 w-max m-2">
                        <div id="" th:onclick="''" th:text="${user.getUsername()}" class="bg-slate-300 font-bold flex items-center justify-center ring-4 hover:ring-blue-900 rounded-full w-24 h-24"></div>
                    </div>
                </div>
                <div class="scrolll shadow-lg shadow-black/25 overflow-y-scroll flex-grow bg-slate-100/75 max-w-lg m-2 rounded">
                    <h2 th:if="${selecteduser}" th:text="${selecteduser.username}"></h2>
                    <div>

                    </div>
                </div>
            </div>
            <div class="max-w-lg m-6 rounded-md shadow-lg shadow-black/50 bg-slate-100 p-4 overflow-hidden">
                <form id="form" class=" flex gap-4 flex-col rounded">
                    <textarea name="message" rows="5" type="text" class="outline-none p-2" placeholder="Message"></textarea>
                    <input type="submit" class=" bg-sky-700 px-4 hover:bg-sky-500 text-white py-2 rounded" value="send" />
                </form>
            </div>
        </div>
    </div>
    <script>
        const socket = new WebSocket("ws://"+window.location.host+"/message")

        socket.onmessage = function(event) {
            console.log("Received message: "+event.data)
        }

        socket.onopen = function(event) {
            socket.send(JSON.stringify({
                "channel": "1"
            }));
        }

        socket.onclose = (event) => {
            console.log("WebSocket connection closed!");
        }

        document.querySelector("#form").addEventListener('submit', handleSend)
        function  handleSend(e) {
            e.preventDefault()
            const message = JSON.stringify({
                message: e.target.message.value,
                sender: e.target.sender.value
            })

            socket.send(message)
        }
    </script>
</body>
</html>